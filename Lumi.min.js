/*!
 * LumiJS JavaScript Library
 * https://lumi.js.org
 *
 * Copyright (c) 2020 Sunay Komarla
 * Released under The MIT License (MIT)
 * https://opensource.org/licenses/MIT
 */
var Lumi=function(){console.error("LumiJS: Lumi has no object to work with")};Lumi.canvas=document.createElement("CANVAS"),Lumi.canvas.id="canvas",Lumi.canvas.width=400,Lumi.canvas.height=400,document.body.appendChild(Lumi.canvas);const ctx=Lumi.canvas.getContext("2d");document.body.style.overflow="hidden",Lumi.canvasCheck={width:"normal",height:"normal"},Lumi.camera={view:"top"},Lumi.gravity=0,Lumi.objects=[],Lumi.include=function(){},Lumi.checkCollision=function(i,t){return i.x<t.x+t.width&&i.x+i.width>t.x&&i.y<t.y+t.height&&i.y+i.height>t.y},Lumi.object=class{constructor(i,t,e,s,o){o||(o={id:0,restitution:0,collision:{collide:!0,affect:!0},mass:1,color:"#000000"}),void 0===o.id&&(o.id=0),void 0===o.restitution&&(o.restitution=0),void 0===o.collision&&(o.collision={collide:!0,affect:!0}),void 0===o.collision.collide&&(o.collision.collide=!0),void 0===o.collision.affect&&(o.collision.affect=!0),void 0===o.mass&&(o.mass=1),void 0===o.color&&(o.color="#000000"),this.id=o.id,this.x=i,this.y=t,this.width=e,this.height=s,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.color=o.color,this.restitution=o.restitution,this.collision=o.collision,this.gravity=0,this.mass=o.mass,this.velocity={x:0,y:0,increase:{x:0,y:0}}}getMidX(){return this.halfWidth+this.x}getMidY(){return this.halfHeight+this.y}getTop(){return this.y}getLeft(){return this.x}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}addXVel(i){this.velocity.x+=i}addYVel(i){this.velocity.y+=i}update(){this.x+=this.velocity.x,this.y+=this.velocity.y,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.y<=window.innerHeight-this.height?this.gravity=Lumi.gravity:(this.velocity.increase.y=0,this.gravity=0,this.y=window.innerHeight-this.height),"side"===Lumi.camera.view&&0!==this.mass&&(this.y+=this.gravity*this.mass+this.velocity.increase.y,this.velocity.increase.y++);for(var i=0;i<Lumi.objects.length;i++)this!==Lumi.objects[i]&&this.collision.collide&&Lumi.objects[i].collision.collide&&Lumi.checkCollision(this,Lumi.objects[i])&&this.collision.affect&&(this.y<Lumi.objects[i].y+this.height&&(this.velocity.increase.y=0,this.gravity=0,this.y=Lumi.objects[i].y-this.height),Lumi.resolveCollision(this,Lumi.objects[i]))}},Lumi.rect=class extends Lumi.object{constructor(i,t,e,s,o){super(i,t,e,s,o),this.type="rect",this.render="rect"}},Lumi.ellipse=class extends Lumi.object{constructor(i,t,e,s,o){super(i,t,e,s,o),this.type="ellipse",this.render="ellipse"}},Lumi.img=class extends Lumi.object{constructor(i,t,e,s,o,c){super(t,e,s,o,c),this.type="rect",this.render="img",this.img=i}},Lumi.light=class extends Lumi.object{constructor(i,t,e,s){s||(s={id:0,restitution:0,collision:{collide:!1,affect:!1},mass:0,color:"rgba(255, 255, 0, 1)"}),void 0===s.id&&(s.id=0),void 0===s.color&&(s.color="rgba(255, 255, 0, 1)"),this.id=s.id,this.type="rect",this.render="light",this.x=i,this.y=t,this.radius=e,this.width=e,this.height=e,this.color=s.color,this.mass=0,this.velocity={x:0,y:0,increase:{x:0,y:0}}}},Lumi.addRect=function(i,t,e,s,o){return Lumi.objects.push(new Lumi.rect(i,t,e,s,o)),Lumi.objects[Lumi.objects.length-1]},Lumi.addEllipse=function(i,t,e,s,o){return Lumi.objects.push(new Lumi.ellipse(i,t,e,s,o)),Lumi.objects[Lumi.objects.length-1]},Lumi.addImg=function(i,t,e,s,o,c){return Lumi.objects.push(new Lumi.img(i,t,e,s,o,c)),Lumi.objects[Lumi.objects.length-1]},Lumi.addLight=function(i,t,e,s){return Lumi.objects.push(new Lumi.light(i,t,e,s)),Lumi.objects[Lumi.objects.length-1]},Lumi.resolveCollision=function(i,t){var e=i.getMidX(),s=i.getMidY(),o=t.getMidX(),c=t.getMidY(),h=(o-e)/t.halfWidth,n=(c-s)/t.halfHeight,u=Math.abs(h),l=Math.abs(n);if(Math.abs(u-l)<.1){if(i.x=h<0?t.getRight()+i.width:t.getLeft()-i.width,n<0)for(i.y=t.getBottom(),i.jumping=!0;checkCollision(t);)i.y++;else i.jumping=!1,i.y=t.getTop()-i.height;Math.random()<.5?i.velocity.x=-i.velocity.x*t.restitution:i.velocity.y=-i.velocity.y*t.restitution}else if(u>l)i.x=h<0?t.getRight()+i.width:t.getLeft()-i.width,i.velocity.x=-i.velocity.x*t.restitution;else{if(n<0)for(i.y=t.getBottom();checkCollision(t);)i.y++;else i.jumping=!1,i.y=t.getTop()-i.height;i.velocity.y=-i.velocity.y*t.restitution}},Lumi.config=function(i){void 0===i.canvas.width&&(i.canvas.width=400),"fitToWindow"===i.canvas.width&&(i.canvas.width=window.innerWidth,Lumi.canvasCheck.width="fitToWindow"),void 0===i.canvas.height&&(i.canvas.height=400),"fitToWindow"===i.canvas.height&&(i.canvas.height=window.innerHeight,Lumi.canvasCheck.height="fitToWindow"),void 0===i.camera&&(i.camera={view:"top"}),void 0===i.gravity&&(i.gravity=0),void 0===i.include&&(i.include=function(){}),Lumi.canvas.width=i.canvas.width,Lumi.canvas.height=i.canvas.height,Lumi.camera=i.camera,Lumi.gravity=i.gravity,Lumi.include=i.include},Lumi.resize=function(){"fitToWindow"===Lumi.canvasCheck.width&&(Lumi.canvas.width=window.innerWidth),"fitToWindow"===Lumi.canvasCheck.height&&(Lumi.canvas.height=window.innerHeight)},window.onresize=Lumi.resize,Lumi.renderFrame=function(){scrollTo(10,10),ctx.clearRect(0,0,window.innerWidth,window.innerHeight),"function"==typeof Lumi.include&&Lumi.include();for(var i=0;i<Lumi.objects.length;i++)if("rect"===Lumi.objects[i].render)ctx.fillStyle=Lumi.objects[i].color,ctx.fillRect(Lumi.objects[i].x,Lumi.objects[i].y,Lumi.objects[i].width,Lumi.objects[i].height),Lumi.objects[i].update(),ctx.fillStyle="#000000";else if("ellipse"===Lumi.objects[i].render)ctx.beginPath(),ctx.ellipse(Lumi.objects[i].x,Lumi.objects[i].y,Lumi.objects[i].width,Lumi.objects[i].height,0,0,2*Math.PI,!1),ctx.fillStyle=Lumi.objects[i].color,ctx.fill(),Lumi.objects[i].update(),ctx.fillStyle="#000000";else if("img"===Lumi.objects[i].render)ctx.drawImage(Lumi.objects[i].img,Lumi.objects[i].x,Lumi.objects[i].y,Lumi.objects[i].width,Lumi.objects[i].height),Lumi.objects[i].update();else if("light"===Lumi.objects[i].render){var t=ctx.createRadialGradient(Lumi.objects[i].x,Lumi.objects[i].y,0,Lumi.objects[i].x,Lumi.objects[i].y,Lumi.objects[i].radius);t.addColorStop(0,Lumi.objects[i].color),t.addColorStop(1,"rgba(0, 0, 0, 0)"),ctx.beginPath(),ctx.fillStyle=t,ctx.arc(Lumi.objects[i].x,Lumi.objects[i].y,Lumi.objects[i].radius,0,2*Math.PI,!1),ctx.fill(),Lumi.objects[i].update(),ctx.fillStyle="#000000"}},Lumi.init=function(){requestAnimationFrame(Lumi.init),Lumi.renderFrame()};